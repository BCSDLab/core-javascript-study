# 2주차 - 실행 컨텍스트

# 목차

- 실행 컨텍스트란?
- VariableEnvironment
- LexicalEnvironment
- this

# 실행컨텍스트란?

<aside>
💡 실행할 코드에 제공할 환경 정보들을 모아놓은 객체이다

</aside>


<aside>
💡 JS는 어떤 실행 컨텍스트가 활성화 되는 시점에 선언된 변수를 위로 끌어올리고(호이스팅), 외부 환경 정보를 구성하고, this값을 설정하는 등의 동작을 수행한다.

</aside>

- 동일한 환경에 있는 코드들을 실행할 때, 필요한 환경 정보들을 모아 컨텍스트를 구성하고, 이를 콜 스택(Call Stack)에 쌓아 올렸다가, 가장 위에 쌓여있는 컨텍스트와 관련있는 코드들을 실행하는 식으로 전체 코드의 환경과 순서를 보장한다.
- 흔히 실행 컨텍스트를 구성하는 방법은 **함수를 실행하는 것.**
- JS 코드를 실행하는 순간 전역 컨텍스트가 콜 스택에 담긴다.최상단의 공간은 코드 내부에서 별도의 실행 명령이 없어도 브라우저에서 자동으로 실행된다.
- 스택(Stack) 구조를 가지기 때문에 실행 컨텍스트가 콜 스택의 맨 위에 쌓이는 순간이 곧 현재 실행할 코드에 관여하게 되는 시점이다.

<aside>
💡 어떤 실행 컨텍스트가 활성화 될 때 JS 엔진은 해당 컨텍스트에 관련된 코드들을 실행하는 데 필요한 정보들을 수집해서 실행 컨텍스트 객체에 저장한다

</aside>

- 실행 컨텍스트에 담기는 정보
    - VariableEnvironment
        - 현재 컨텍스트 내의 식별자들에 대한 정보 + 외부 환경 정보. 선언 시점의 LexicalEnvironment의 스냅샷으로, 변경 사항은 반영되지 않는다.
    - LexicalEnvironment
        - 처음에는 VariableEnvironment와 같지만 변경 사항이 실시간으로 반영된다.
    - ThisBinding
        - this 식별자가 바라봐야 할 대상 객체

# VariableEnvironment

- 실행 컨텍스트를 생성할 때, VariableEnvironment에 정보를 먼저 담은 다음(스냅샷), 이를 그대로 복사에서 LexicalEnvironment를 만들고, 이후에는 이를 활용한다.
- 내부는 environmentRecord와 outer-EnvironmentReference로 구성되어 있다.

# LexicalEnvironment

## environmentRecord와 호이스팅

- environmentRecord에는 현재 컨텍스트와 관련된 코드의 식별자 정보들이 **순서대로** 수집된다.
- 실행 컨텍스트가 관여할 코드들은 실행되기 전의 상태이지만, JS 엔진은 이미 해당 환경에 속한 코드의 변수명들을 모두 알고 있게 되는 것이다.
- 호이스팅이란 식별자들을 최상단으로 끌어올린 다음 실제 코드를 실행한다고 가정하여 좀 더 이해하기 쉽도록 한 가상의 개념

### 호이스팅 규칙

- environmentRecord는 현재 실행될 컨텍스트의 대상 코드 내에 어떤 식별자들이 있는지에만 간심이 있고, 각 식별자에 어떤 값이 할당될 지는 관심이 없기 때문에, 변수를 호이스팅할 때는 변수명만 끌어올리고 할당 과정은 원래 자리에 그대로 남겨둔다. 매개변수도 동일하다.
- 함수의 선언 같은 경우, 함수 전체를 끌어올리게 된다,

### 함수 선언문과 함수 표현식

- 함수 선언문 : function 정의부만 존재하고 별도의 할당 명령이 없는 것.
- 함수 표현식 : 정의한 function을 별도의 변수에 할당하는 것.
- 함수명을 정의한 함수 표현식을 기명 함수 표현식, 정의하지 않은 것을 익명 함수 표현식이라고 부르기도 하는데, 일반적으로 함수 표현식은 익명 함수 표현식을 말한다.

<aside>
💡 기명 함수 표현식의 경우 외부에서는 함수명으로 함수를 호출할 수 없으니 주의하자.

</aside>

<aside>
💡 함수가 호이스팅이 되었을 경우, 함수 선언문은 전체를 호이스팅한 반면에 함수 표현식은 변수 선언부만 호이스팅 되게 된다.

</aside>

## 스코프, 스코프 체인, outerEnvironmentReference

- 스코프란 식별자에 대한 유효범위
- 스코프를 안에서부터 바깥으로 차례로 검색해나가는 것이 스코프 체인이며, 이걸 가능하게 하는 것이 outerEnvironmentReference

### 스코프 체인

- outerEnvironmentReference는 현재 호출된 함수가 **선언될 당시의** LexicalEbvironment를 참조한다.
- A함수 내부에 B함수를 선언하고, 그 내부에 C함수를 선언한 경우, C의 outerEnvironmentReference는 함수 B의 LexicalEnvionment를 참조하게 된다. 이를 계속해서 거슬러올라가면 마지막에는 전역 컨텍스트의 LexicalEnvironment가 있다. 이처럼 outerEnvironment는 연결리스트의 형태를 띈다.
- 또한 각 outerEnvironmentReference는 어직 자신이 선언된시점에 LexicalEnvrionment만 참조하므로 가장 가까운 요소로부터 차례대로만 접근할 수 있다.
- 이러한 특징 때문에 여러 스코프에서 동일한 식별자를 선언했을 때, 무조건 스코프 체인 상에서 가장 먼저 발견된 식별자에만 접근 가능하게 된다.
